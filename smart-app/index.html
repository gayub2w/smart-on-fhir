<!DOCTYPE html>
<html lang="en" hidden>
  <head>
	  
	  	   <!-- Application-level javascript-->
	<link rel="stylesheet" href="./src/css/SOFCSS.css">
	<script src='./src/js/global.js'></script>
    	<script src='./src/js/example-smart-app.js'></script>
	<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"> 
    	<meta http-equiv='X-UA-Compatible' content='IE=edge' />
    	<meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<meta charset="utf-8">
  	<meta name="viewport" content="width=device-width, initial-scale=1">
  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>  
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">  
        <title>SMART APP</title> 
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <link rel='stylesheet' type='text/css' href='./src/css/example-smart-app.css'>
        <link rel='stylesheet' type='text/css' href='./lib/css/cerner-smart-embeddable-lib-1.0.0.min.css'>
	  
<style>
</style>	
  </head>
  <body>
	
 
<header hidden id = "doctor-view-head">
	<div class="row">
  <div class="column" >
    
    	<h4 style="margin-left:1.5em;"><b><span id='lname'></span>, <span id='fname'></span></b></h4>
	<h4 style="margin-left:1.5em;">LOC:USC-GI;200;Q </h4>
	<h4 style="margin-left:1.5em;">Observation[Admit Dt:8/3/2018 6:07..</h4>
  </div>
  <div class="column" >
    
        <h4><span>Age: </span><span id='age'></h4>
	<h4><b>D.O.B: </b><span id='birthdate'></span></h4>
	<h4><span id='pract_name'></span></h4>

  </div>
  <div class="column" >

	 <h4><span >Sex: </span><span id='gender'></span></h4>
	  <h4><span>MyUSC Chart:Invite Sent</span></h4>
	<h4>Blood Trans Acceptable to pt?Yes</h4>
  </div>
  <div class="column">
    
        <h4>**Allergies**</h4>
	
	
	
  </div>
	
	
</header>
		

	

 <section hidden id = "doctor-view">
  <nav>  
  
<table id="t01"class="table">
    
 <div class="icon-bar01">
			<span  style="margin-left:0.7em;" >Menu - All</span><i style=" font-size: 7px; left: 18em; margin-bottom:0.2em;" class="glyphicon glyphicon-triangle-bottom white"></i>
</div>
    <tbody>
		<tr>
        <td>Ambulatory Summary</td>
      </tr>
      <tr>
        <td>Inpatient Summaries</td>
      </tr>
      <tr>
        <td>Operative Summaries</td>
      </tr>
      <tr>
        <td>Demographics</td>
      </tr>
	  <tr>
        <td>Results Review</td>
      </tr>
      <tr>
        <td>Allergies</td>
      </tr>
      <tr>
        <td>Orders</td>
      </tr>
	  <tr id="protab">
        <td><b>Order PRO</b></td>
      </tr>
	  <tr>
        <td>Medication List</td>
      </tr>
      <tr>
        <td>Reports/Documents</td>
      </tr>
      <tr>
        <td>MAR Summary</td>
      </tr>
	  <tr>
        <td>Form Browser</td>
      </tr>
      <tr>
        <td>Pending Studies</td>
      </tr>
      <tr>
        <td>Problem And Diagnoses</td>
      </tr>
	  <tr>
        <td>Immunizations</td>
      </tr>
      <tr>
        <td>Reference Text</td>
      </tr>
      <tr>
        <td>Patient Schedule</td>
      </tr>
	  <tr>
        <td>Appointments</td>
      </tr>
      <tr>
        <td>Access Center and Pre-Arrival</td>
      </tr>
      
    </tbody>
  </table>
  </nav>
 
  <article id="docview-article">
  <div class="icon-bar">
			<span>&nbsp; </span><i style="color:#407798" class="glyphicon glyphicon-chevron-left"></i><span>&nbsp;&nbsp; </span><i style="color:#407798" class="glyphicon glyphicon-chevron-right "></i>&nbsp;&nbsp; <i style=" font-size: 7px; margin-bottom:0.2em;" class="glyphicon glyphicon-triangle-bottom white"></i><span id="v1"></span>&nbsp;&nbsp; <i class="glyphicon glyphicon-home white"></i> <span style="margin-left:0.5em; font-color:#FFFFFF; font-size:20px;"> Order PRO</span><img border="0" style="margin-bottom:0.2em;margin-left:40em;" src="./src/images/pixel-full-screen.png"  />&nbsp;Fullscreen&nbsp;&nbsp;&nbsp;<i class="glyphicon glyphicon-print white"></i>&nbsp;  Print&nbsp; &nbsp; <i class="glyphicon glyphicon-refresh white"></i><span> &nbsp;2 minutes ago &nbsp; </span>
			</div>
  <h3 style="margin-left:0.5em;">Order PRO</h3>
	

	<div style="position:relative;width:200px;height:25px;border:0;padding:0;margin:0;">
		<select id="selectform"  style="position:absolute;top:0px;left:0px;width:400px; height:25px;line-height:20px;margin-left:1em;padding:0;">
		<option value="" disabled selected >Please choose an instrument...</option>
		 

		</select>
		</br>
		</br>
		<button class="button button3" style="margin-left:1em;" type="button" onclick="order_func()">Order</button>
	</div>
    </br>
	</br>
    </br>
	
	<h3 style="margin-left:0.5em;">Order Status</h3>

<table id="t02">
  <tr>
	  <th>Event Date Time</th>	  
    <th>PROs Ordered</th>
    <th>Status</th>
    <th>Results</th>
	  <th>Ref Range</th>
  </tr>
  <tr>
	  <td> 2018-07-18 </td>
    <td>PROMIS Bank v2.0 - Emotional Support</td>
    <td>Ordered</td>
    <td> -- </td>
	  <td> </td>
  </tr>
  <tr>
	  <td> 2018-07-06 </td>
    <td>PROMIS Bank v2.0 - Physical Function</td>
    <td>Completed</td>
	  <td> <a target="_blank" href="./src/res.html">PROMIS T-SCORE 41.9</a></td>
	  <td> 1 - 100 </td>
  </tr>
  </table>

  </br>
			

	<h3 style="margin-left:0.5em;">Recommended PRO for <b> <span id='fname1'></span> <span id='lname1'></span></b></h3>
	<div id="content">
	  </div>  
  </article>
</section>

<section hidden id="patient-view" >
	
	<div class="container-fluid">
		<div class="row">
			<div id="pat-header" class="col-12 col-lg-12 col-md-12 col-sm-12 col-xs-12 " >
			</br>
			<P style="margin-left:1em; text-align: left; font-size: 28px;">Welcome <b> <span id='firstname'></span> <span id='lastname'></span></b>!</P></br></br>			
			</div>
		</div>	
		<div id="list">
				
		</div>		
	</div>

	<div hidden id="Ques" class="container-fluid">
		<div  class="row"  style="text-align: left; padding-top: 20px; font-size: 14px;">
					<div id="header1"  class="col-12 col-lg-12 col-md-12 col-sm-12 col-xs-12">
					 <p style='margin-left:1em;'><b>Questionnaire for <span id='pro-name'></span></b></p>
						</br>
						</br>
					</div>
		</div>
						
		
		<div id="Content"  class="row" >
		</div>
		
	</div>
	
	
</section>
	<script>
		
		
			
			
		
		
		
		
		
			function order_func() {
			
			var e = document.getElementById("selectform");
			var sformoid = e.options[e.selectedIndex].value;
			var sformname = e.options[e.selectedIndex].text;
			alert("FormOID : " + sformoid);
			alert("FormName : " + sformname);	
					var date1 =new Date(new Date().toString().split('GMT')[0]+' UTC').toISOString().split('.')[0];
							console.log(date1);
							console.log(window.patient_id);
							//console.log(practitioner_id);
							//console.log(window.gender2);
							//console.log(window.dobstr2);	
			var prdata = "{\n\t\"resourceType\": \"ProcedureRequest\",\n\t\"status\": \"active\",\n\t\"category\": [{\n\t\t\"coding\": [{\n\t\t\t\"system\": \"http://snomed.info/sct\",\n\t\t\t\"code\": \"386053000\",\n\t\t\t\"display\": \"Evaluation procedure (procedure)\"\n\t\t}],\n\t\t\"text\": \"Evaluation\"\n\t}],\n\t\"code\": {\n\t\t\"coding\": [{\n\t\t\t\"system\": \"http://loinc.org\",\n\t\t\t\"code\": \""+sformoid+"\",\n\t\t\t\"display\": \""+sformname+"\"\n\t\t}],\n\t\t\"text\": \""+sformname+"\"\n\t},\n\t\"occurrenceDateTime\": \""+date1+"\",\n\t\"subject\": {\n\t\t\"reference\": \"Patient/"+patient_id+"\"\n\t},\n\t\"performer\": {\n\t\t\"reference\": \"Patient/"+patient_id+"\"\n\t},\n\t\"reasonCode\": {\n\t\t\"coding\": [{\n\t\t\t\"system\": \"http://snomed.info/sct\",\n\t\t\t\"code\": \"35489007\",\n\t\t\t\"display\": \""+sformname+"\"\n\t\t}]\n\t}\n}";
				//var prdata = "{\n\t\"resourceType\": \"ProcedureRequest\",\n\t\"status\": \"active\",\n\t\"category\": [{\n\t\t\"coding\": [{\n\t\t\t\"system\": \"http://snomed.info/sct\",\n\t\t\t\"code\": \"386053000\",\n\t\t\t\"display\": \"Evaluation procedure (procedure)\"\n\t\t}],\n\t\t\"text\": \"Evaluation\"\n\t}],\n\t\"code\": {\n\t\t\"coding\": [{\n\t\t\t\"system\": \"http://loinc.org\",\n\t\t\t\"code\": \""+sformoid+"\",\n\t\t\t\"display\": \""+sformname+"\"\n\t\t}],\n\t\t\"text\": \""+sformname+"\"\n\t},\n\t\"occurrenceDateTime\": \""+date1+"\",\n\t\"subject\": {\n\t\t\"reference\": \"Patient/4342008\"\n\t},\n\t\"performer\": {\n\t\t\"reference\": \"Patient/4342008\"\n\t},\n\t\"reasonCode\": {\n\t\t\"coding\": [{\n\t\t\t\"system\": \"http://snomed.info/sct\",\n\t\t\t\"code\": \"35489007\",\n\t\t\t\"display\": \""+sformname+"\"\n\t\t}]\n\t}\n}";

					var settings1 = {
					  "async": true,
					  "crossDomain": true,
					  "url": "https://sapphire-demo.meliorix.com/dev/cds-hook-api/api/resource/post/procedure",	
					  "method": "POST",
					  "headers": {
					    "Content-Type": "application/json",
					    "Cache-Control": "no-cache",
					    "Postman-Token": "15f84b11-8896-8e3f-e7be-6e11cdd23f43"
					  },
					  "processData": false,
					  "data": prdata
					}
							
					$.ajax(settings1).done(function (response) {
					  console.log("amhere  ");
					  console.log(response);
					});
										
			}
		
					
		
				var form_oid=[];
				var form_name=[];
				var Server = "https://www.assessmentcenter.net/ac_api";
				var FormOID = "96FE494D-F176-4EFB-A473-2AB406610626";  // Sample form -- replace with your FormOID
				var promisUID="001";
				
				function callback1(data){
				//console.log(data);
			
					}
				function listForms() {
					$.ajax({
						url: Server + "/2014-01/Forms/.json",
						cache: false,
						type: "POST",
						data: "",
						dataType: "json",
						beforeSend: function(xhr) {
						 var Reg = "2807BB48-28D3-4FFA-823A-F5E7EBF7E52D";
						 var Token = "A0159F7B-E971-46E6-B62D-7A6085F53F19";
						
						 var base64 = btoa(Reg + ":" + Token);
						xhr.setRequestHeader("Authorization", "Basic " + base64);
						},
							success: function(data) { 
							
								console.log(data);
								//callback1(data);
								//console.log("am here");	
								var container = document.getElementById("Content");
								var forms = data.Form;
								
								var select = document.getElementById("selectform"); 
								
								//console.log("all forms"+forms);
								for (var i=0; i < forms.length; i++) {
									form_oid[i]=forms[i].OID;
									form_name[i]=forms[i].Name;
									var opt = forms[i].Name;
									var val = forms[i].OID;
									var el = document.createElement("option");
									el.textContent = opt;
									el.value = val;
									select.appendChild(el);
								
									//console.log(forms[i].OID + " : " + forms[i].Name + "");
									//var myform = document.createElement("div");
									//myform.innerHTML = forms[i].OID + " : " + forms[i].Name + "";
									//container.appendChild(myform);
								}
								
							},
						
							error: function(jqXHR, textStatus, errorThrown) {
								document.write(jqXHR.responseText + ':' + textStatus + ':' + errorThrown);
							}
						});
				}	
			
				function formDetails(FormOID) {
								$.ajax({
									url: Server + "/2014-01/Forms/" + FormOID + ".json",
									cache: false,
									type: "POST",
									data: "",
									dataType: "json",
									beforeSend: function(xhr) {
													var Reg = "2807BB48-28D3-4FFA-823A-F5E7EBF7E52D";
													var Token = "A0159F7B-E971-46E6-B62D-7A6085F53F19";
													
													var base64 = btoa(Reg + ":" + Token);
													xhr.setRequestHeader("Authorization", "Basic " + base64);
									},
									success: function(data) {
												//console.log(data);			
												
												
												
									},
								
									error: function(jqXHR, textStatus, errorThrown) {
										alert(jqXHR.responseText + ':' + textStatus + ':' + errorThrown);
									}
								})
							}
							
	function prorecommend() {	
		patient_id="";
		gender2="";
		dobstr2="";
		//console.log("pls"+practitioner_id);
	var recdata= "{\n   \"hook\" : \"patient-view\",\n   \"hookInstance\" : \"d1577c69-dfbe-44ad-ba6d-3e05e953b2ea\",\n   \"fhirServer\" : \"https://54.202.74.232:80/cip-fhir3/baseDstu3\",\n   \"user\" : \"Practitioner/"+practitioner_id+"\",\n   \"patient\": \""+patient_id+"\",\n   \"context\" : {\n       \"patientId\" : \""+patient_id+"\"\n   },\n   \"prefetch\" : {\n      \"patient\" : {\n         \"resourceType\" : \"Patient\",\n         \"gender\" : \""+gender2+"\",\n         \"birthDate\" : \""+dobstr2+"\",\n         \"id\" : \""+patient_id+"\",\n         \"active\" : true\n      }\n   }\n}";			
		
var settings = {
  "async": true,
  "crossDomain": true,
  "url": "https://sapphire-demo.meliorix.com/cds-hook-api/api/v1/cds-services/pro-recommend",
  "method": "POST",
  "headers": {
    "Content-Type": "application/json",
    "Cache-Control": "no-cache",
    "Postman-Token": "35410d6a-12f4-4145-9655-db99cdaa0e90"
  },
  "processData": false,
  "data": recdata
}
			$.ajax(settings).done(function (response) {
			  //console.log(response);
			  
			  jQuery(response).each(function(i, item){
								
								console.log(item.cards)
								jQuery(item.cards).each(function(j, item){
											//console.log(item.summary);
											//console.log(item.detail);
											var $t1 = item.summary;
											var $t2 = item.detail;
											var $t3 = item.source.label;
											var $t4;
											jQuery(item.suggestions).each(function(k, item){
											$t4 = item.label;
											//console.log($t4);
											})
											jQuery(item.links).each(function(l, item){
											$t5 = item.label;
											$t6 = item.url;
											//console.log($t5);
											//console.log($t6);
											})
											
											$("#docview-article").append("<div class='panel panel-default'>	<div id='rec' class='panel-body'><b style='color:#0079BE;font-size: 16px;'>"+$t1 + "</b></br>"+ "<I style='font-size: 12px;'>Source: <span style='color:blue;font-size: 12px;'>"+$t3 + "</span></I></br></br>"+$t2+"</br><button class='button button4' type='button' onclick='alert('Test!')'>"+ $t4+"</button></br><a href='"+$t6+"'>"+$t5+"</a></div> </div>")
																					
											$("rec").append("<b>"+$t1+"</b>");
											$("rec").append("</br>");$("rec").append("</br>");
											$("rec").append($t2);
											$("rec").append("</br>");$("rec").append("</br>");$("rec").append("</br>");
											
											//document.getElementById("demo").innerHTML = item.summary + "</br>" + item.detail;
								})
								//console.log(item.cards[i])
							})
			  
			 //document.getElementById("demo").innerHTML = response[0];
			});
			
	}
			
			
//console.log(form_oid);	
listForms();
formDetails(FormOID);
prorecommend();
		
		
// Flow for the patient app
		
		
		
		var global_asmtOID;
		var datefin;
		var Server = "https://www.assessmentcenter.net/ac_api";
		var ItemResponseOID = "";   
		var Response = "";  
		var assessmentOID;	
		var FormOID;		
		//var FormOID ="80C5D4A3-FC1F-4C1B-B07E-10B796CF8105";
		
		
		
			function B(r)
				{
					
					console.log(r);
					console.log("fin");
					
					
				}
		
		
		var temp= document.getElementById("pro-name");
		function writeProname(proname)
				{
					
					temp.innerHTML = proname;
					
					
				}
		
		
		
		function startTask(taskId){
		var settings = {
				  "async": true,
				  "crossDomain": true,
				  "url": "https://sapphire-demo.meliorix.com/dev/cds-hook-api/api/v1/cds-task/"+taskId+"/start",
				  "method": "POST",
				  "headers": {
					"userId": patID,
					"Cache-Control": "no-cache",
					"Postman-Token": "db0f09f2-afff-45ff-9a20-1d2d05bea38c"
				  }
				}

				$.ajax(settings).done(function (response) {
				  console.log(response);
				});		
		}
		
		function completeProcess(taskId){
		
						var settings = {
				  "async": true,
				  "crossDomain": true,
				  "url": "https://sapphire-demo.meliorix.com/dev/cds-hook-api/api/v1/cds-task/"+taskId+"/completeTask",
				  "method": "POST",
				  "headers": {
					"userId": patID,
					"Content-Type": "application/json",
					"Cache-Control": "no-cache",
					"Postman-Token": "3b7630b9-7061-49e1-acb9-9e4eda4bf487"
				  },
				  "processData": false,
				  "data": "{\n  \"patientId\": \""+patID+"\"\n}"
				}

				$.ajax(settings).done(function (response) {
				  console.log(response);
				});
		}
		
	
				
		
		
		function displayList(){
			
		var settings3 = {
				  "async": false,
				  "crossDomain": true,
				  "url": "https://sapphire-demo.meliorix.com/dev/cds-hook-api/api/v1/cds-task/getTasksOwned",
				  "method": "GET",
				  "headers": {
					"userId": patID,
					"Cache-Control": "no-cache",
					"Postman-Token": "bd1cfc8b-da36-4f74-ac1c-289fde061b9c"
				  }
				}

				$.ajax(settings3).done(function (response) {

				  console.log(response);
				  var str="";
				  
				  str = str+ "<div class=\'row\'>	<div id=\'new\' class=\'col-12 col-lg-12 col-md-12 col-sm-12 col-xs-12\'></br>";
							str = str+ "<P style=\'margin-left:1em; text-align: left; padding: 10px; \'><b>List of Questionnaires available for you</b></P>	</div></div>";
								
							str = str+ "<div id=\'tabhead\' class=\'row\' style=\'text-align: left; font-weight: bold; padding-top: 20px; \'>";
							str = str+ "<div class=\'col-4 col-lg-4 col-md-4 col-sm-4 col-sm-offset-1 col-xs-4 \'>Questionnaire</div>";
							str = str+ "<div class=\'col-2 col-lg-2 col-md-2 col-sm-2 col-sm-offset-1 col-xs-4 \'>Due Date</div>";
							str = str+"<div class=\'col-4 col-lg-4 col-md-4 col-sm-4 col-xs-4 \'>Status</div></div>";	
							
				  jQuery(response).each(function(i, item){
							console.log(item);
							//console.log(item.taskId);
							//console.log(item.taskInputs);
							//console.log(item.taskInputs.proIdentifier);
							//console.log(item.taskInputs.proName);
							//str = str + JSON.stringify(item, null, 2); // spacing level = 2
							
									if (item.taskInputs.proIdentifier!=null){
							
							str = str + "<div class=\'row\'  style=\'text-align: left; padding-top: 20px; font-size: 14px;\'>";
								
							str = str + "<div class=\'col-4 col-lg-4 col-md-4 col-sm-4 col-sm-offset-1 col-xs-4\' style=\'text-align: left; font-size: 18px;\'>"+item.taskInputs.proName+"</div>"
							str = str + "<div class=\'col-2 col-lg-2 col-md-2 col-sm-2 col-sm-offset-1 col-xs-4\'>09/10/2018</div>";
							str = str + "<div class=\'col-4 col-lg-4 col-md-4 col-sm-4 col-xs-4 \'><button id=\""+item.taskId+"\" value=\""+item.taskInputs.proName+"\" class=\'button button6\' type=\'button\' onclick=\' callasmt(\""+item.taskInputs.proIdentifier+"\"); displayQ(); startTask(this.id); completeProcess(this.id); writeProname(this.value); this.disabled=true; \'>Start</button></div></div>";
							}
						
							
				  
				  });
				  
				  document.getElementById("list").innerHTML = str;
				});

	}
		
		
		
	
	function displayQ(){
	
		$('#Ques').show();
		//$('#Content').show();

		window.location.hash = '#Ques'; 
		
		document.getElementById('list').style.display = 'none';
		//document.getElementById('fav').style.display = 'none';
	}
	
	//Important small functions
	
	
	
	//Everytime the user selects an answer for a question from the options, we call getResponse function to store the response 
	//Call rec function repeatedly which in turn calls the renderscreen funtion with stored response parameters , until the datefinished variable is not null
		function getResponse(res1,res2)
		{
		//console.log(res1);
		//console.log(res2);
		ItemResponseOID = res2;   
		Response = res1;   
		rec();
		}
		
		
		function rec(){
		if (datefin== '') 
		{
		renderScreen(assessmentOID);
		}
		}	
		
		
	// Just to hide the PRO list when the Questionnaire is displayed
		function displist()
		{
				//completeProcess();
				window.location.reload(false);
				//displayList();
				document.getElementById('Content').style.display = 'none';
				document.getElementById('header1').style.display = 'none';
				document.getElementById('list').style.display = 'block';
		}
		
		
		
	
	
	
	
	//Function to call the assessmentcenter starting an Assessement API to get the assessmentOID
	function startAssessment(FormOID) {
						var tmp =null;
						$.ajax({
							url: Server + "/2014-01/Assessments/" + FormOID + ".json",
							cache: false,
							async: false,
							type: "POST",
							data: "UID=01" ,
							dataType: "json",

							beforeSend: function(xhr) {
							   var Reg = "2807BB48-28D3-4FFA-823A-F5E7EBF7E52D";
																		var Token = "A0159F7B-E971-46E6-B62D-7A6085F53F19";
																		
																		var base64 = btoa(Reg + ":" + Token);
																		xhr.setRequestHeader("Authorization", "Basic " + base64);
							},
						
							success: function(data) {
							  //console.log(data);
							  //console.log(data.OID);
							  global_asmtOID=data.OID;
							  tmp = data.OID;
							  //console.log(global_asmtOID + "test1");
							  
							 
							  
							},
						
							error: function(jqXHR, textStatus, errorThrown) {
								document.write(jqXHR.responseText + ':' + textStatus + ':' + errorThrown);
							}
						})
						return tmp;
			}
	
	
	
	//Function to call the assessmentcenter scoring API to return the theta(T-score) json
	function displayScore(assessmentOID) {
					//console.log(assessmentOID);
					$.ajax({
					url:  "https://www.assessmentcenter.net/ac_api/2014-01/Results/" + assessmentOID + ".json",
					cache: false,
					async:false,
					type: "POST",
					data: "",
					dataType: "json",

					beforeSend: function(xhr) {
																var Reg = "2807BB48-28D3-4FFA-823A-F5E7EBF7E52D";
																var Token = "A0159F7B-E971-46E6-B62D-7A6085F53F19";
																
																var base64 = btoa(Reg + ":" + Token);
																xhr.setRequestHeader("Authorization", "Basic " + base64);
					},

					success: function(data) { 
					   console.log(data);
					   var data1=data.Items;
					   var data2=data1[0];
					   
					 var key;

						for (key in data2) {
							if (data2.hasOwnProperty(key)) {
								console.log(key + " = " + data2[key]);
							}
						}  

								
								
					   console.log(data.Theta);
					   var T_Score = data.Theta * 10 + 50.0;
					   console.log("T-Score : " + T_Score);
					},
				
					error: function(jqXHR, textStatus, errorThrown) {
						alert('displayScore:' + jqXHR.responseText + ':' + textStatus + ':' + errorThrown);
					}
				})
		}
								
		//						
		function renderScreen(asmtOID) { 
		
					var tmp1 =null;
					
							var postedData ="";
							
							if (ItemResponseOID != "") {
								postedData ="ItemResponseOID=" + ItemResponseOID + "&Response=" + Response ;
							}		
							
					
					
				$.ajax({
					url: "https://www.assessmentcenter.net/ac_api/2014-01/Participants/"+asmtOID+".json",
					
					cache: false,
					type: "POST",
					async:false,
					data: postedData,
					dataType: "json",
					

					beforeSend: function (xhr) {
																var Reg = "2807BB48-28D3-4FFA-823A-F5E7EBF7E52D";
																var Token = "A0159F7B-E971-46E6-B62D-7A6085F53F19";
																
																var base64 = btoa(Reg + ":" + Token);
																xhr.setRequestHeader("Authorization", "Basic " + base64);
					},

					success: function (data) {
							tmp1=data.DateFinished;
						 if (data.DateFinished != '') {
							displayScore(assessmentOID);
							document.getElementById("Content").innerHTML = "You have finished the assessment.<br /> Thank you ! <div style=\'height: 50px\' ><button type=\'button\' class='button button6'  onclick=displist() > Back </button></div>";
							return
						}

						 var screen = "";
						var HasBitWiseValues = false;
						var HasMultipleItems = false;

						if (data.Items.length > 1) {
							HasMultipleItems = true;
						}
						
    	
						//screen= screen + "<p style='margin-left:1em;'><b>Questionnaire for <span id='pro-name'></span></b></p></br>"
						//var win = window.open("", "Title", "toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=780,height=200,top="+(screen.height-400)+",left="+(screen.width-840));


						if (!HasMultipleItems) {
							for (var i = 0; i < data.Items.length; i++) {
								for (var j = 0; j < data.Items[i].Elements.length; j++) {
									if (typeof (data.Items[i].Elements[j].Map) == 'undefined') {
										screen = screen + "<div class='row'><div id='question' class='col-12 col-lg-12 col-md-12 col-sm-12 col-xs-12' style=\'height: 30px\' >" + data.Items[i].Elements[j].Description + "</br></div></div></br></br>"
									} else {
										for (var k = 0; k < data.Items[i].Elements[j].Map.length; k++) {
											switch (data.Items[i].Elements[j].Map[k].Description) {
												case "INFORMATIONAL":
													screen = screen + "<div style=\'height: 50px\' ><input type=\'button\' class='btn-submit' id=\'" + data.Items[i].Elements[j].Map[k].Value + "\' name=\'" + data.Items[i].Elements[j].Map[k].ItemResponseOID + "\' value=\'" + "Save" + "\' onclick=getResponse('" + data.Items[i].Elements[j].Map[k].Value+"'\,'"+data.Items[i].Elements[j].Map[k].ItemResponseOID +"') />" + "</div>";
													break;
												case "TEXT":
													screen = screen + "<div style=\'height: 50px\' ><input type=\'text\'  id=\'" + data.Items[i].Elements[j].Map[k].Value + "\' name=\'" + data.Items[i].Elements[j].Map[k].ItemResponseOID + "\' value=\'" + data.Items[i].Elements[j].Map[k].Description + "\' />" + "</div>";
													screen = screen + "<div style=\'height: 50px\' ><input type=\'button\' class='btn-submit' id=\'" + "btnSave" + "\' name=\'" + "btnSave" + "\' value=\'" + "Save" + "\' onclick=getResponse('" + data.Items[i].Elements[j].Map[k].Value+"'\,'" + data.Items[i].Elements[j].Map[k].ItemResponseOID+"') />" + "</div>";
													break;
												default:
													ItemResponseOID = data.Items[i].Elements[j].Map[k].ItemResponseOID;
													Response = data.Items[i].Elements[j].Map[k].Value;
													if (data.Items[i].Elements[j].Map[k].DataType == "bitwise") {
														HasBitWiseValues = true;
														screen = screen + "<div style=\'height: 20px\' ><input type=\'checkbox\' id=\'" + data.Items[i].Elements[j].Map[k].ItemResponseOID + "\' name=\'" + data.Items[i].FormItemOID + "\' value=\'" + data.Items[i].Elements[j].Map[k].Value + "\' onclick=addResponse(this) />" + data.Items[i].Elements[j].Map[k].Description + "</div>";
													} else {
														screen = screen + "<div style=\'height: 50px\' ><input type=\'button\' class='btn-submit' id=\'" + data.Items[i].Elements[j].Map[k].Value + "\' name=\'" + data.Items[i].Elements[j].Map[k].ItemResponseOID + "\' value=\'" + data.Items[i].Elements[j].Map[k].Description + "\' onclick=getResponse('" + data.Items[i].Elements[j].Map[k].Value+"'\,'"+data.Items[i].Elements[j].Map[k].ItemResponseOID+"') />" + "</div>";
													}
											}
										}
										//screen = screen + "<div style=\'height: 50px\' ><input type=\'button\' class='btn-submit' id=\'" + '00000000-0000-0000-0000-000000000000' + "\' name=\'" + '00000000-0000-0000-0000-000000000000' + "\' value=\'" + 'SKIP' + "\' onclick=getResponse('" + '00000000-0000-0000-0000-000000000000+","+00000000-0000-0000-0000-000000000000' + "') />" + "</div>";
									}
								}
								if (HasBitWiseValues) {
									screen = screen + "<div class='row'><div style=\'height: 50px\' ><input type=\'text\'  id=\'" + data.Items[i].FormItemOID + "\' name=\'" + data.Items[i].FormItemOID + "\' value=\'0\' />" + "</div></div>";
								}
							}
						} else {
							/* Stem (e.g., "Thinking about how your illness...") */
							screen += "<div style=\'height: 50px; text-align: bottom\'>" + data.Items[0].Elements[0].Description + "</div>";

							/* Question */
							screen += "<div style=\'height: 40px; font-style: italic\'>" + data.Items[0].Elements[1].Description + "</div>";

							screen += "<table>";

							/* "How true was this before/since your illness?" */
							screen += "<tr>";
							screen += "<td width=\'50%\'><div style=\'height: 20px\'>" + data.Items[1].Elements[1].Description + "</div></td>";
							screen += "<td width=\'10px\'></td>";
							screen += "<td><div style=\'height: 20px\'>" + data.Items[2].Elements[1].Description + "</div></td>";
							screen += "</tr>";

							/* Answers */
							theQuestion = data.Items[0].FormItemOID;
							for (var i = 0; i < 5; i++) {
								screen += "<tr>";
								screen += "<td><div style=\'height: 50px\'><input type=\'button\' class=\'btn-submit\' id=\'" + data.Items[1].Elements[2].Map[i].FormItemOID + "\' name=\'" + data.Items[1].Elements[2].Map[i].Value + "\' value=\'" + data.Items[1].Elements[2].Map[i].Description + "\' onclick=getResponseMultiple(this) />" + "</div>";
								screen += "<td width=\'10px\'></td>";
								screen += "<td><div style=\'height: 50px\'><input type=\'button\' class=\'btn-submit\' id=\'" + data.Items[2].Elements[2].Map[i].FormItemOID + "\' name=\'" + data.Items[2].Elements[2].Map[i].Value + "\' value=\'" + data.Items[2].Elements[2].Map[i].Description + "\' onclick=getResponseMultiple(this) />" + "</div>";
								screen += "</tr>"
							}
							screen += "<tr><td colspan=\'3\' style=\'height: 70px; text-align: center; vertical-align: bottom\'><div><input type=\'button\' class='btn-submit' id=\'btnSave\' name=\'btnSave\' value=\'Save\' onclick=getResponseSave()></div></td></tr>";
							screen += "</table>";
						}

						document.getElementById("Content").innerHTML = screen;
					},

					error: function (jqXHR, textStatus, errorThrown) {
						alert('renderScreen: ' + jqXHR.responseText + ':' + textStatus + ':' + errorThrown);
					}
				})
					
				return tmp1;
	}							
								
								


								
			
										
		//displayList();						
	// APIs to administer the assessmentcenter forms
					
		function callasmt(FormOID){
									
								//console.log(FormOID);
								
								assessmentOID = startAssessment(FormOID);

								datefin=renderScreen(assessmentOID);
				
								}
		
	
		
					
										
						
		
		
	
				

		
		
		
		
		
		
</script>	

  
    <!-- Required JS files to enable this page to embed within an MPage -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/6.26.0/polyfill.min.js'></script>
    <script src='./lib/js/cerner-smart-embeddable-lib-1.0.0.min.js'></script>

   

    <!-- FHIR Client JS Library -->
    <script src='./lib/js/fhir-client-v0.1.12.js'></script>

    <!-- Prevent session bleed caused by single threaded embedded browser and sessionStorage API -->
    <!-- https://github.com/cerner/fhir-client-cerner-additions -->
    <script src='./lib/js/fhir-client-cerner-additions-1.0.0.js'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>
      extractData().then(
        //Display Patient Demographics and Observations if extractData was success
        function(p) {
          drawVisualization(p);
        },
        //Display 'Failed to call FHIR Service' if extractData failed
        function() {
          $('#loading').hide();
          $('#errors').html('<p> Failed to call FHIR Service </p>');
        }
      );
    </script>
  </body>
</html>
